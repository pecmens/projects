<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒè‰²çƒæŸ¥è¯¢ç³»ç»Ÿ</title>
    <script src="https://cdn.bootcdn.net/ajax/libs/angular.js/1.8.3/angular.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }
        
        .content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            min-height: 400px;
        }
        
        h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .table th {
            background: #f5f5f5;
            color: #333;
            font-weight: 600;
        }
        
        .table tr:hover {
            background: #f9f9f9;
        }
        
        .ball {
            display: inline-block;
            width: 36px;
            height: 36px;
            line-height: 36px;
            text-align: center;
            border-radius: 50%;
            font-weight: bold;
            margin: 2px;
        }
        
        .red-ball {
            background: #ff4757;
            color: white;
        }
        
        .blue-ball {
            background: #3742fa;
            color: white;
        }
        
        .result {
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .result.success {
            background: #d4edda;
            color: #155724;
        }
        
        .result.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .result.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stats-box {
            padding: 20px;
            border-radius: 8px;
            background: #f5f5f5;
        }
        
        .stats-box h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .pagination button {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .pagination button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .red-balls-input {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }
        
        .red-balls-input input {
            text-align: center;
        }
    </style>
</head>
<body ng-app="ssqApp" ng-controller="MainCtrl">
    <div class="container">
        <div class="header">
            <h1>ğŸ± åŒè‰²çƒæŸ¥è¯¢ç³»ç»Ÿ</h1>
            <p>å†å²å¼€å¥–æŸ¥è¯¢ Â· ä¸­å¥–æ ¸å¯¹ Â· ç»Ÿè®¡åˆ†æ</p>
        </div>
        
        <div class="tabs">
            <button class="tab" ng-class="{active: currentTab === 'query'}" ng-click="switchTab('query')">å¼€å¥–æŸ¥è¯¢</button>
            <button class="tab" ng-class="{active: currentTab === 'check'}" ng-click="switchTab('check')">ä¸­å¥–æ ¸å¯¹</button>
            <button class="tab" ng-class="{active: currentTab === 'stats'}" ng-click="switchTab('stats')">ç»Ÿè®¡åˆ†æ</button>
            <button class="tab" ng-class="{active: currentTab === 'manage'}" ng-click="switchTab('manage')">æ•°æ®ç®¡ç†</button>
        </div>
        
        <div class="content">
            <!-- æŸ¥è¯¢é¡µé¢ -->
            <div ng-show="currentTab === 'query'">
                <h2>ğŸ“Š å¼€å¥–è®°å½•æŸ¥è¯¢</h2>
                <div class="form-group">
                    <label>æœç´¢æ–¹å¼</label>
                    <select ng-model="searchType" ng-change="toggleSearchInput()">
                        <option value="all">æ˜¾ç¤ºå…¨éƒ¨</option>
                        <option value="times">æŒ‰æœŸå·</option>
                        <option value="date">æŒ‰æ—¥æœŸ</option>
                    </select>
                </div>
                <div class="form-group" ng-show="searchType !== 'all'">
                    <label>{{searchType === 'times' ? 'æœŸå·' : 'æ—¥æœŸ'}}</label>
                    <input type="text" ng-model="searchValue" placeholder="è¯·è¾“å…¥æœç´¢å€¼">
                </div>
                <button class="btn" ng-click="searchRecords()">æŸ¥è¯¢</button>
                
                <div ng-if="loading" class="loading">åŠ è½½ä¸­...</div>
                <div ng-if="!loading && records.length > 0">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>æœŸå·</th>
                                <th>æ—¥æœŸ</th>
                                <th>çº¢çƒ</th>
                                <th>è“çƒ</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="record in records">
                                <td>{{record.times}}</td>
                                <td>{{record.date}}</td>
                                <td>
                                    <span class="ball red-ball" ng-repeat="ball in record.red_balls">{{ball}}</span>
                                </td>
                                <td><span class="ball blue-ball">{{record.blue_ball}}</span></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="pagination" ng-if="totalPages > 1">
                        <button ng-click="loadPage(currentPage - 1)" ng-disabled="currentPage === 1">ä¸Šä¸€é¡µ</button>
                        <span>ç¬¬ {{currentPage}} / {{totalPages}} é¡µ</span>
                        <button ng-click="loadPage(currentPage + 1)" ng-disabled="currentPage === totalPages">ä¸‹ä¸€é¡µ</button>
                    </div>
                </div>
                <div ng-if="!loading && records.length === 0" class="result info">æš‚æ— æ•°æ®</div>
            </div>
            
            <!-- æ ¸å¯¹é¡µé¢ -->
            <div ng-show="currentTab === 'check'">
                <h2>ğŸ¯ ä¸­å¥–æ ¸å¯¹</h2>
                <div class="form-group">
                    <label>çº¢çƒå·ç ï¼ˆ6ä¸ªï¼‰</label>
                    <div class="red-balls-input">
                        <input type="text" ng-model="check.red[0]" placeholder="01" maxlength="2">
                        <input type="text" ng-model="check.red[1]" placeholder="02" maxlength="2">
                        <input type="text" ng-model="check.red[2]" placeholder="03" maxlength="2">
                        <input type="text" ng-model="check.red[3]" placeholder="04" maxlength="2">
                        <input type="text" ng-model="check.red[4]" placeholder="05" maxlength="2">
                        <input type="text" ng-model="check.red[5]" placeholder="06" maxlength="2">
                    </div>
                </div>
                <div class="form-group">
                    <label>è“çƒå·ç ï¼ˆ1ä¸ªï¼‰</label>
                    <input type="text" ng-model="check.blue" placeholder="01" maxlength="2">
                </div>
                <div class="form-group">
                    <label>æŒ‡å®šæœŸå·ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" ng-model="check.times" placeholder="ç•™ç©ºåˆ™æ ¸å¯¹æœ€æ–°ä¸€æœŸ">
                </div>
                <button class="btn" ng-click="checkPrize()">æ ¸å¯¹ä¸­å¥–</button>
                
                <div ng-if="checkResult" class="result" ng-class="checkResult.prize === 'æœªä¸­å¥–' ? 'info' : 'success'">
                    <h3>ä¸­å¥–ç­‰çº§: {{checkResult.prize}}</h3>
                    <p>å¼€å¥–æœŸå·: {{checkResult.record.times}}</p>
                    <p>å¼€å¥–æ—¥æœŸ: {{checkResult.record.date}}</p>
                    <p>å¼€å¥–å·ç : <span class="ball red-ball" ng-repeat="ball in checkResult.record.red_balls">{{ball}}</span> <span class="ball blue-ball">{{checkResult.record.blue_ball}}</span></p>
                    <p>æ‚¨çš„å·ç : <span class="ball red-ball" ng-repeat="ball in check.red">{{ball}}</span> <span class="ball blue-ball">{{check.blue}}</span></p>
                </div>
                <div ng-if="checkError" class="result error">{{checkError}}</div>
            </div>
            
            <!-- ç»Ÿè®¡é¡µé¢ -->
            <div ng-show="currentTab === 'stats'">
                <h2>ğŸ“ˆ ç»Ÿè®¡åˆ†æ</h2>
                <button class="btn" ng-click="loadStatistics()">åˆ·æ–°ç»Ÿè®¡</button>
                
                <div ng-if="statsLoading" class="loading">åŠ è½½ä¸­...</div>
                <div ng-if="!statsLoading && statistics" class="stats-grid">
                    <div class="stats-box">
                        <h3>ğŸ”´ çº¢çƒé¢‘ç‡ï¼ˆå‰10ï¼‰</h3>
                        <div class="stat-item" ng-repeat="item in statistics.red_frequency.slice(0, 10)">
                            <span><span class="ball red-ball">{{item[0]}}</span></span>
                            <span>{{item[1]}}æ¬¡</span>
                        </div>
                    </div>
                    
                    <div class="stats-box">
                        <h3>ğŸ”µ è“çƒé¢‘ç‡ï¼ˆå‰10ï¼‰</h3>
                        <div class="stat-item" ng-repeat="item in statistics.blue_frequency.slice(0, 10)">
                            <span><span class="ball blue-ball">{{item[0]}}</span></span>
                            <span>{{item[1]}}æ¬¡</span>
                        </div>
                    </div>
                    
                    <div class="stats-box">
                        <h3>ğŸ”¥ çƒ­å·ï¼ˆé«˜é¢‘ï¼‰</h3>
                        <p>çº¢çƒ: <span class="ball red-ball" ng-repeat="ball in statistics.hot_numbers.red">{{ball}}</span></p>
                        <p>è“çƒ: <span class="ball blue-ball" ng-repeat="ball in statistics.hot_numbers.blue">{{ball}}</span></p>
                    </div>
                    
                    <div class="stats-box">
                        <h3>â„ï¸ å†·å·ï¼ˆä½é¢‘ï¼‰</h3>
                        <p>çº¢çƒ: <span class="ball red-ball" ng-repeat="ball in statistics.cold_numbers.red">{{ball}}</span></p>
                        <p>è“çƒ: <span class="ball blue-ball" ng-repeat="ball in statistics.cold_numbers.blue">{{ball}}</span></p>
                    </div>
                </div>
            </div>
            
            <!-- ç®¡ç†é¡µé¢ -->
            <div ng-show="currentTab === 'manage'">
                <h2>âš™ï¸ æ•°æ®ç®¡ç†</h2>
                <div class="form-group">
                    <button class="btn" ng-click="initDatabase()">åˆå§‹åŒ–æ•°æ®åº“</button>
                    <button class="btn" ng-click="updateData()" style="margin-left: 10px;">æ›´æ–°æ•°æ®</button>
                </div>
                
                <div ng-if="manageResult" class="result success">
                    <p>{{manageResult.message}}</p>
                    <p ng-if="manageResult.total">å…± {{manageResult.total}} æ¡è®°å½•</p>
                    <p ng-if="manageResult.added !== undefined">æ–°å¢ {{manageResult.added}} æ¡ï¼Œæ›´æ–° {{manageResult.updated}} æ¡</p>
                </div>
                <div ng-if="manageError" class="result error">{{manageError}}</div>
            </div>
        </div>
    </div>
    
    <script>
        var app = angular.module('ssqApp', []);
        
        app.controller('MainCtrl', function($scope, $http) {
            $scope.currentTab = 'query';
            $scope.API_BASE = 'http://localhost:5000/api';
            $scope.loading = false;
            $scope.statsLoading = false;
            $scope.currentPage = 1;
            $scope.totalPages = 1;
            
            $scope.searchType = 'all';
            $scope.searchValue = '';
            
            $scope.check = {
                red: ['', '', '', '', '', ''],
                blue: '',
                times: ''
            };
            
            $scope.records = [];
            $scope.statistics = null;
            
            // åˆ‡æ¢æ ‡ç­¾é¡µ
            $scope.switchTab = function(tab) {
                $scope.currentTab = tab;
                if (tab === 'query') {
                    $scope.loadRecords(1);
                }
            };
            
            // åŠ è½½å¼€å¥–è®°å½•
            $scope.loadRecords = function(page) {
                $scope.loading = true;
                $http.get($scope.API_BASE + '/records?page=' + page + '&per_page=20')
                    .then(function(response) {
                        $scope.records = response.data.records;
                        $scope.currentPage = response.data.current_page;
                        $scope.totalPages = response.data.pages;
                        $scope.loading = false;
                    })
                    .catch(function(error) {
                        $scope.loading = false;
                        alert('åŠ è½½å¤±è´¥: ' + (error.data.error || error.statusText));
                    });
            };
            
            // æœç´¢è®°å½•
            $scope.searchRecords = function() {
                $scope.loading = true;
                var url = $scope.API_BASE + '/records/search';
                var params = [];
                
                if ($scope.searchType === 'times' && $scope.searchValue) {
                    params.push('times=' + $scope.searchValue);
                }
                if ($scope.searchType === 'date' && $scope.searchValue) {
                    params.push('date=' + $scope.searchValue);
                }
                
                if (params.length > 0) {
                    url += '?' + params.join('&');
                }
                
                $http.get(url)
                    .then(function(response) {
                        $scope.records = response.data.records;
                        $scope.loading = false;
                    })
                    .catch(function(error) {
                        $scope.loading = false;
                        alert('æœç´¢å¤±è´¥: ' + (error.data.error || error.statusText));
                    });
            };
            
            // åŠ è½½é¡µé¢
            $scope.loadPage = function(page) {
                if (page >= 1 && page <= $scope.totalPages) {
                    $scope.loadRecords(page);
                }
            };
            
            // æ ¸å¯¹ä¸­å¥–
            $scope.checkPrize = function() {
                var redBalls = $scope.check.red.map(function(val) {
                    return val.trim().padStart(2, '0');
                });
                
                if (redBalls.some(function(v) { return !v; })) {
                    alert('è¯·è¾“å…¥6ä¸ªçº¢çƒå·ç ');
                    return;
                }
                
                var blueBall = $scope.check.blue.trim().padStart(2, '0');
                if (!blueBall) {
                    alert('è¯·è¾“å…¥è“çƒå·ç ');
                    return;
                }
                
                $scope.checkResult = null;
                $scope.checkError = null;
                
                $http.post($scope.API_BASE + '/check', {
                    red_balls: redBalls,
                    blue_ball: blueBall,
                    times: $scope.check.times || null
                })
                    .then(function(response) {
                        $scope.checkResult = response.data;
                    })
                    .catch(function(error) {
                        $scope.checkError = error.data.error || 'æ ¸å¯¹å¤±è´¥';
                    });
            };
            
            // åŠ è½½ç»Ÿè®¡æ•°æ®
            $scope.loadStatistics = function() {
                $scope.statsLoading = true;
                $http.get($scope.API_BASE + '/stats')
                    .then(function(response) {
                        $scope.statistics = response.data;
                        $scope.statsLoading = false;
                    })
                    .catch(function(error) {
                        $scope.statsLoading = false;
                        alert('åŠ è½½å¤±è´¥: ' + (error.data.error || error.statusText));
                    });
            };
            
            // åˆå§‹åŒ–æ•°æ®åº“
            $scope.initDatabase = function() {
                if (!confirm('ç¡®å®šè¦åˆå§‹åŒ–æ•°æ®åº“å—ï¼Ÿè¿™å°†åˆ›å»ºæ•°æ®åº“å¹¶åŠ è½½å†å²æ•°æ®ã€‚')) {
                    return;
                }
                
                $scope.manageResult = null;
                $scope.manageError = null;
                
                $http.post($scope.API_BASE + '/init')
                    .then(function(response) {
                        $scope.manageResult = response.data;
                    })
                    .catch(function(error) {
                        $scope.manageError = error.data.error || 'åˆå§‹åŒ–å¤±è´¥';
                    });
            };
            
            // æ›´æ–°æ•°æ®
            $scope.updateData = function() {
                if (!confirm('ç¡®å®šè¦æ›´æ–°æ•°æ®å—ï¼Ÿ')) {
                    return;
                }
                
                $scope.manageResult = null;
                $scope.manageError = null;
                
                $http.post($scope.API_BASE + '/update')
                    .then(function(response) {
                        $scope.manageResult = response.data;
                    })
                    .catch(function(error) {
                        $scope.manageError = error.data.error || 'æ›´æ–°å¤±è´¥';
                    });
            };
            
            // åˆå§‹åŒ–åŠ è½½
            $scope.loadRecords(1);
        });
    </script>
</body>
</html>